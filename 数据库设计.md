### **1. ç”¨æˆ·è¡¨ï¼ˆusersï¼‰**

- ç”¨æˆ·IDï¼ˆä¸»é”®ï¼‰
- ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
- å¯†ç å“ˆå¸Œ
- è§’è‰²ï¼ˆæšä¸¾ï¼šSUPER_ADMIN/ADMIN/USERï¼Œé»˜è®¤USERï¼‰
- æ€»é²œèŠ±æ•°ï¼ˆåˆ«äººé€ç»™æˆ‘çš„èŠ±ï¼‰
- ç´¯è®¡å¼€åŒ…æ•°
- è¿ç»­ç­¾åˆ°å¤©æ•°
- ç´¯è®¡åœ¨çº¿æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
- æˆ‘çš„é‚€è¯·ç ï¼ˆå”¯ä¸€ï¼‰
- æˆ‘æ˜¯è¢«è°é‚€è¯·çš„ï¼ˆå¤–é”®æŒ‡å‘å¦ä¸€ä¸ªç”¨æˆ·ï¼‰
- æ³¨å†Œæ—¶é—´
- æœ€åç™»å½•æ—¶é—´
- æœ€åç­¾åˆ°æ—¶é—´
- ç­‰çº§ï¼ˆè¿˜æ²¡æƒ³å¥½æœ‰ä»€ä¹ˆç”¨ï¼Œå…ˆç•™ç€ï¼‰
- æ˜¯å¦å°ç¦

**è§’è‰²è¯´æ˜ï¼š**
- **SUPER_ADMINï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰**ï¼šæ‹¥æœ‰æœ€é«˜æƒé™ï¼Œå¯ä»¥ç®¡ç†æ‰€æœ‰æ•°æ®å’Œç”¨æˆ·ï¼ŒåŒ…æ‹¬è®¾ç½®å…¶ä»–ç®¡ç†å‘˜
- **ADMINï¼ˆæ™®é€šç®¡ç†å‘˜ï¼‰**ï¼šå¯ä»¥ç®¡ç†ç”¨æˆ·ã€å•è¯ã€å¡åŒ…ç­‰å†…å®¹ï¼Œä½†ä¸èƒ½è®¾ç½®å…¶ä»–ç®¡ç†å‘˜
- **USERï¼ˆæ™®é€šç”¨æˆ·ï¼‰**ï¼šé»˜è®¤è§’è‰²ï¼Œåªèƒ½è®¿é—®å’Œç®¡ç†è‡ªå·±çš„æ•°æ®

### **2. å•è¯è¡¨ï¼ˆwordsï¼‰**

- å•è¯IDï¼ˆä¸»é”®ï¼‰
- å•è¯æœ¬èº«ï¼ˆå”¯ä¸€ï¼Œæ¯”å¦‚ "apple"ï¼‰
- ä¸­æ–‡é‡Šä¹‰ï¼ˆæ¯”å¦‚ "è‹¹æœ"ï¼‰
- ç¨€æœ‰åº¦ï¼ˆcommon/rare/epic/legendaryï¼‰
- å‘éŸ³ï¼ˆéŸ³æ ‡æˆ–è¯­éŸ³æ–‡ä»¶URLï¼‰
- å•è¯å˜ä½“ï¼ˆåŒ…å«å¤šä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œå…ƒç´ æ˜¯å•è¯çš„å¤æ•°å½¢å¼æˆ–å…¶ä»–æ—¶æ€ç­‰å˜ä½“ï¼‰
- åˆ›å»ºæ—¶é—´
- è¯æ€§


---

### **3. ç”¨æˆ·å•è¯åº“å­˜è¡¨ï¼ˆuser_wordsï¼‰**

- ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
- å•è¯IDï¼ˆå¤–é”®ï¼‰
- æ˜¯å¦æ”¶è—åˆ°ç”Ÿè¯æœ¬
- è·å¾—æ—¶é—´


### **4. å¡åŒ…è¡¨ï¼ˆpacksï¼‰**

- å¡åŒ…IDï¼ˆä¸»é”®ï¼‰
- å¡åŒ…åç§°ï¼ˆæ¯”å¦‚ æ™®é€šå¡åŒ…æˆ–è€…ä¼ è¯´å¡åŒ…ï¼‰
- å¡åŒ…æè¿°
- æ¯åŒ…å¤šå°‘å¼ å¡ï¼ˆæ¯”å¦‚5å¼ ï¼‰
- ç¨€æœ‰åº¦æƒé‡ï¼ˆJSONæ ¼å¼ï¼Œæ¯”å¦‚ {"common": 70, "rare": 20, "epic": 8, "legendary": 2}ï¼‰
- æ˜¯å¦å¯ç”¨ï¼ˆå¯ä»¥ä¸‹æ¶æŸäº›å¡åŒ…ï¼‰
- åˆ›å»ºæ—¶é—´


### **5. ç”¨æˆ·å¡åŒ…åº“å­˜è¡¨ï¼ˆuser_packsï¼‰**

è®°å½•"ç”¨æˆ·æ‹¥æœ‰å¤šå°‘ä¸ªæŸç§å¡åŒ…"ã€‚

**æ ¸å¿ƒå­—æ®µï¼š**
- ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
- å¡åŒ…IDï¼ˆå¤–é”®ï¼‰
- æ•°é‡

**è”åˆä¸»é”®ï¼š**
- ï¼ˆç”¨æˆ·ID + å¡åŒ…IDï¼‰



---

### **6. æ¶ˆæ¯è¡¨ï¼ˆmessagesï¼‰**

- æ¶ˆæ¯IDï¼ˆä¸»é”®ï¼Œå¯ä»¥ç”¨æ—¶é—´æˆ³+éšæœºæ•°ï¼‰
- ç”¨æˆ·IDï¼ˆå¤–é”®ï¼Œè°å‘çš„ï¼‰
- æ¶ˆæ¯å†…å®¹
- é²œèŠ±æ•°ï¼ˆè¿™æ¡æ¶ˆæ¯æ”¶åˆ°å¤šå°‘èŠ±ï¼‰
- æ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§ï¼‰
- å¼•ç”¨æ¶ˆæ¯IDï¼ˆè¡¨ç¤ºå¼•ç”¨äº†å“ªæ¡åˆ«çš„æ¶ˆæ¯ï¼‰


ã€æ¶ˆæ¯åªä¿ç•™æœ€è¿‘24å°æ—¶çš„ã€‘
---

### **7. é€èŠ±è®°å½•è¡¨ï¼ˆrose_sendersï¼‰**

è®°å½•"è°ç»™å“ªæ¡æ¶ˆæ¯é€äº†èŠ±"ï¼Œé˜²æ­¢é‡å¤é€èŠ±ã€‚

- æ¶ˆæ¯IDï¼ˆå¤–é”®ï¼‰
- é€èŠ±äººIDï¼ˆå¤–é”®ï¼‰
- é€èŠ±æ—¶é—´
**è”åˆä¸»é”®ï¼š**
- ï¼ˆæ¶ˆæ¯ID + é€èŠ±äººIDï¼‰ç¡®ä¿ä¸€ä¸ªäººåªèƒ½ç»™ä¸€æ¡æ¶ˆæ¯é€ä¸€æ¬¡èŠ±

### **8. å›¾é‰´è¡¨ï¼ˆcollectionsï¼‰**

**æ ¸å¿ƒå­—æ®µï¼š**
- å›¾é‰´IDï¼ˆä¸»é”®ï¼‰
- å›¾é‰´åç§°ï¼ˆæ¯”å¦‚ "åŠ¨ç‰©å›¾é‰´"ï¼‰
- æè¿°
- å›¾æ ‡
- å®Œæˆå¥–åŠ± ï¼ˆå¡åŒ…ï¼‰
- åˆ›å»ºæ—¶é—´

---

### **9. å›¾é‰´å•è¯å…³è”è¡¨ï¼ˆword_collectionsï¼‰**

è®°å½•"å“ªäº›å•è¯å±äºå“ªä¸ªå›¾é‰´"ã€‚

**æ ¸å¿ƒå­—æ®µï¼š**
- å›¾é‰´IDï¼ˆå¤–é”®ï¼‰
- å•è¯IDï¼ˆå¤–é”®ï¼‰

**è”åˆä¸»é”®ï¼š**
- ï¼ˆå›¾é‰´ID + å•è¯IDï¼‰ã€ä¸€ä¸ªå•è¯å¯ä»¥å±äºå¤šä¸ªå›¾é‰´ã€‘

---

### **10. ç”¨æˆ·å›¾é‰´å®Œæˆè®°å½•è¡¨ï¼ˆuser_collectionsï¼‰**

è®°å½•"ç”¨æˆ·å®Œæˆäº†å“ªäº›å›¾é‰´"ã€‚

**æ ¸å¿ƒå­—æ®µï¼š**
- ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
- å›¾é‰´IDï¼ˆå¤–é”®ï¼‰
- å®Œæˆæ—¶é—´

**è”åˆä¸»é”®ï¼š**
- ï¼ˆç”¨æˆ·ID + å›¾é‰´IDï¼‰



---

### **11. æˆå°±è¡¨ï¼ˆachievementsï¼‰**

**æ ¸å¿ƒå­—æ®µï¼š**
- æˆå°±IDï¼ˆä¸»é”®ï¼‰
- æˆå°±åç§°ï¼ˆæ¯”å¦‚ "é²œèŠ±è¾¾äºº"ï¼‰
- æè¿°
- å›¾æ ‡ï¼ˆå¯é€‰ï¼‰
- æˆå°±ç±»åˆ«ï¼ˆæ¯”å¦‚"æ”¶é›†ç±»"ã€"ç¤¾äº¤ç±»"ï¼‰
- æ˜¯å¦æ˜¯éšè—æˆå°±
**è§£é”æ¡ä»¶ï¼š**
- æ¡ä»¶ç±»å‹ï¼ˆæ¯”å¦‚ "total_roses"ã€"vocab_count"ã€"consecutive_days"ï¼‰
- æ¡ä»¶å€¼ï¼ˆæ¯”å¦‚100ï¼‰

**å¥–åŠ±ï¼š**
- å¥–åŠ±é²œèŠ±æ•°
- å¥–åŠ±å¡åŒ…ï¼ˆJSONæ ¼å¼ï¼Œå¯é€‰ï¼‰

**æ—¶é—´æˆ³ï¼š**
- åˆ›å»ºæ—¶é—´

### **12. ç”¨æˆ·æˆå°±è®°å½•è¡¨ï¼ˆuser_achievementsï¼‰**

è®°å½•"ç”¨æˆ·è§£é”äº†å“ªäº›æˆå°±"ã€‚

**æ ¸å¿ƒå­—æ®µï¼š**
- ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
- æˆå°±IDï¼ˆå¤–é”®ï¼‰
- è§£é”æ—¶é—´

**è”åˆä¸»é”®ï¼š**
- ï¼ˆç”¨æˆ·ID + æˆå°±IDï¼‰

---

### **13. ç­¾åˆ°å¥–åŠ±è®°å½•è¡¨ï¼ˆlogin_rewardsï¼‰**

è®°å½•"ç”¨æˆ·æ¯æ¬¡ç­¾åˆ°çš„å¥–åŠ±"ã€‚

**æ ¸å¿ƒå­—æ®µï¼š**
- è®°å½•IDï¼ˆä¸»é”®ï¼‰
- ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
- ç¬¬å‡ å¤©ï¼ˆè¿ç»­ç­¾åˆ°çš„å¤©æ•°ï¼‰
- å¥–åŠ±é²œèŠ±æ•°
- å¥–åŠ±å¡åŒ…ï¼ˆJSONæ ¼å¼ï¼Œå¯é€‰ï¼‰
- é¢†å–æ—¶é—´

å¥½çš„ï¼è®©æˆ‘å¸®ä½ æ¢³ç†æ‰€æœ‰éœ€è¦çš„æ¥å£ã€‚

---

## ğŸŒ æ¥å£è®¾è®¡æ€»è§ˆ

### **æŠ€æœ¯é€‰å‹å»ºè®®ï¼š**
- **HTTP æ¥å£**ï¼šç”¨äºæ•°æ®æŸ¥è¯¢ã€çŠ¶æ€ä¿®æ”¹ï¼ˆRESTful APIï¼‰
- **WebSocket æ¥å£**ï¼šç”¨äºå®æ—¶èŠå¤©ã€åœ¨çº¿çŠ¶æ€ã€å®æ—¶é€šçŸ¥

---

## ğŸ“¡ HTTP æ¥å£ï¼ˆREST APIï¼‰

### **1. ç”¨æˆ·è®¤è¯æ¨¡å—**

#### **POST /api/auth/register**
æ³¨å†Œæ–°ç”¨æˆ·
```json
è¯·æ±‚ï¼š
{
  "username": "testuser",
  "password": "password123",
  "inviteCode": "ABC123" // å¯é€‰
}

å“åº”ï¼š
{
  "success": true,
  "data": {
    "userId": "uuid",
    "username": "testuser",
    "role": "USER",
    "inviteCode": "XYZ789",
    "token": "jwt_token"
  }
}
```

#### **POST /api/auth/login**
ç”¨æˆ·ç™»å½•
```json
è¯·æ±‚ï¼š
{
  "username": "testuser",
  "password": "password123"
}

å“åº”ï¼š
{
  "success": true,
  "data": {
    "userId": "uuid",
    "username": "testuser",
    "role": "USER",
    "token": "jwt_token",
    "user": {
      "totalRoses": 100,
      "level": 5,
      "consecutiveDays": 3
    }
  }
}
```

#### **POST /api/auth/logout**
ç”¨æˆ·ç™»å‡º
```json
è¯·æ±‚ï¼š
{
  "token": "jwt_token"
}

å“åº”ï¼š
{
  "success": true
}
```

#### **GET /api/auth/verify**
éªŒè¯ Token æ˜¯å¦æœ‰æ•ˆ
```json
è¯·æ±‚å¤´ï¼š
Authorization: Bearer jwt_token

å“åº”ï¼š
{
  "success": true,
  "data": {
    "userId": "uuid",
    "username": "testuser"
  }
}
```

---

### **2. ç”¨æˆ·ä¿¡æ¯æ¨¡å—**

#### **GET /api/users/me**
è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "userId": "uuid",
    "username": "testuser",
    "role": "USER",
    "totalRoses": 100,
    "totalPacks": 50,
    "consecutiveDays": 3,
    "level": 5,
    "inviteCode": "ABC123",
    "registeredAt": "2025-12-01T10:00:00Z",
    "isBanned": false
  }
}
```

#### **GET /api/users/:userId**
è·å–æŒ‡å®šç”¨æˆ·ä¿¡æ¯ï¼ˆå…¬å¼€ä¿¡æ¯ï¼‰
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "userId": "uuid",
    "username": "testuser",
    "role": "USER",
    "totalRoses": 100,
    "level": 5,
    "registeredAt": "2025-12-01T10:00:00Z"
  }
}
```

#### **PUT /api/users/me**
æ›´æ–°å½“å‰ç”¨æˆ·ä¿¡æ¯
```json
è¯·æ±‚ï¼š
{
  "avatar": "https://...",  // å¯é€‰
  "bio": "Hello world"      // å¯é€‰
}

å“åº”ï¼š
{
  "success": true,
  "data": {
    "userId": "uuid",
    "username": "testuser",
    "avatar": "https://...",
    "bio": "Hello world"
  }
}
```

---

### **3. å•è¯æ¨¡å—**

#### **GET /api/words**
è·å–å•è¯åˆ—è¡¨ï¼ˆæ”¯æŒç­›é€‰ï¼‰
```json
è¯·æ±‚å‚æ•°ï¼š
?rarity=rare          // æŒ‰ç¨€æœ‰åº¦ç­›é€‰
&search=apple         // æœç´¢å•è¯
&page=1               // åˆ†é¡µ
&limit=20             // æ¯é¡µæ•°é‡

å“åº”ï¼š
{
  "success": true,
  "data": {
    "words": [
      {
        "wordId": "uuid",
        "word": "apple",
        "definition": "è‹¹æœ",
        "rarity": "common",
        "pronunciation": "/ËˆÃ¦pl/",
        "partOfSpeech": "noun",
        "variants": ["apples"]
      }
    ],
    "total": 100,
    "page": 1,
    "limit": 20
  }
}
```

#### **GET /api/words/:wordId**
è·å–å•è¯è¯¦æƒ…
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "wordId": "uuid",
    "word": "apple",
    "definition": "è‹¹æœ",
    "rarity": "common",
    "pronunciation": "/ËˆÃ¦pl/",
    "partOfSpeech": "noun",
    "variants": ["apples"],
    "collections": ["é£Ÿç‰©å›¾é‰´", "åè¯å›¾é‰´"]
  }
}
```

#### **GET /api/users/me/words**
è·å–å½“å‰ç”¨æˆ·çš„å•è¯åº“å­˜
```json
è¯·æ±‚å‚æ•°ï¼š
?isFavorited=true     // åªæ˜¾ç¤ºæ”¶è—çš„
&rarity=legendary     // æŒ‰ç¨€æœ‰åº¦ç­›é€‰
&sortBy=obtainedAt    // æ’åºæ–¹å¼
&page=1
&limit=20

å“åº”ï¼š
{
  "success": true,
  "data": {
    "words": [
      {
        "wordId": "uuid",
        "word": "apple",
        "definition": "è‹¹æœ",
        "rarity": "common",
        "isFavorited": true,
        "obtainedAt": "2025-12-20T10:00:00Z"
      }
    ],
    "total": 50,
    "page": 1,
    "limit": 20
  }
}
```

#### **POST /api/users/me/words/:wordId/favorite**
æ”¶è—/å–æ¶ˆæ”¶è—å•è¯
```json
è¯·æ±‚ï¼š
{
  "isFavorited": true
}

å“åº”ï¼š
{
  "success": true,
  "data": {
    "wordId": "uuid",
    "isFavorited": true
  }
}
```

---

### **4. å¡åŒ…æ¨¡å—**

#### **GET /api/packs**
è·å–æ‰€æœ‰å¡åŒ…åˆ—è¡¨
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "packs": [
      {
        "packId": "uuid",
        "name": "æ™®é€šå¡åŒ…",
        "description": "åŒ…å«å¸¸è§å•è¯",
        "cardCount": 5,
        "weights": {
          "common": 70,
          "rare": 20,
          "epic": 8,
          "legendary": 2
        },
        "isActive": true
      }
    ]
  }
}
```

#### **GET /api/users/me/packs**
è·å–å½“å‰ç”¨æˆ·çš„å¡åŒ…åº“å­˜
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "packs": [
      {
        "packId": "uuid",
        "name": "æ™®é€šå¡åŒ…",
        "description": "åŒ…å«å¸¸è§å•è¯",
        "count": 5
      }
    ]
  }
}
```

#### **POST /api/users/me/packs/:packId/open**
å¼€å¡åŒ…
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "drawnWords": [
      {
        "wordId": "uuid",
        "word": "apple",
        "definition": "è‹¹æœ",
        "rarity": "common",
        "isNew": true  // æ˜¯å¦æ˜¯æ–°è·å¾—çš„å•è¯
      },
      {
        "wordId": "uuid",
        "word": "dragon",
        "definition": "é¾™",
        "rarity": "legendary",
        "isNew": true
      }
    ],
    "remainingPacks": 4,
    "unlockedAchievements": [  // å¯èƒ½è§£é”çš„æˆå°±
      {
        "achievementId": "uuid",
        "name": "å•è¯æ”¶è—å®¶",
        "rewardRoses": 50
      }
    ],
    "completedCollections": [  // å¯èƒ½å®Œæˆçš„å›¾é‰´
      {
        "collectionId": "uuid",
        "name": "åŠ¨ç‰©å›¾é‰´",
        "rewardRoses": 100
      }
    ]
  }
}
```

---

### **5. å›¾é‰´æ¨¡å—**

#### **GET /api/collections**
è·å–æ‰€æœ‰å›¾é‰´åˆ—è¡¨
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "collections": [
      {
        "collectionId": "uuid",
        "name": "åŠ¨ç‰©å›¾é‰´",
        "description": "æ”¶é›†æ‰€æœ‰åŠ¨ç‰©ç›¸å…³å•è¯",
        "icon": "https://...",
        "rewardRoses": 100,
        "totalWords": 50
      }
    ]
  }
}
```

#### **GET /api/collections/:collectionId**
è·å–å›¾é‰´è¯¦æƒ…
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "collectionId": "uuid",
    "name": "åŠ¨ç‰©å›¾é‰´",
    "description": "æ”¶é›†æ‰€æœ‰åŠ¨ç‰©ç›¸å…³å•è¯",
    "icon": "https://...",
    "rewardRoses": 100,
    "words": [
      {
        "wordId": "uuid",
        "word": "cat",
        "definition": "çŒ«",
        "rarity": "common"
      }
    ],
    "totalWords": 50
  }
}
```

#### **GET /api/users/me/collections**
è·å–å½“å‰ç”¨æˆ·çš„å›¾é‰´å®Œæˆè¿›åº¦
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "collections": [
      {
        "collectionId": "uuid",
        "name": "åŠ¨ç‰©å›¾é‰´",
        "description": "æ”¶é›†æ‰€æœ‰åŠ¨ç‰©ç›¸å…³å•è¯",
        "totalWords": 50,
        "ownedWords": 48,
        "progress": 96.0,  // ç™¾åˆ†æ¯”
        "isCompleted": false,
        "hasRewarded": false,
        "rewardRoses": 100
      },
      {
        "collectionId": "uuid",
        "name": "é£Ÿç‰©å›¾é‰´",
        "totalWords": 30,
        "ownedWords": 30,
        "progress": 100.0,
        "isCompleted": true,
        "hasRewarded": true,
        "completedAt": "2025-12-20T10:00:00Z"
      }
    ]
  }
}
```

---

### **6. æˆå°±æ¨¡å—**

#### **GET /api/achievements**
è·å–æ‰€æœ‰æˆå°±åˆ—è¡¨
```json
è¯·æ±‚å‚æ•°ï¼š
?category=æ”¶é›†ç±»      // æŒ‰ç±»åˆ«ç­›é€‰
&showHidden=false    // æ˜¯å¦æ˜¾ç¤ºéšè—æˆå°±

å“åº”ï¼š
{
  "success": true,
  "data": {
    "achievements": [
      {
        "achievementId": "uuid",
        "name": "é²œèŠ±è¾¾äºº",
        "description": "ç´¯è®¡è·å¾—100æœµé²œèŠ±",
        "icon": "https://...",
        "category": "ç¤¾äº¤ç±»",
        "isHidden": false,
        "conditionType": "total_roses",
        "conditionValue": 100,
        "rewardRoses": 50
      }
    ]
  }
}
```

#### **GET /api/users/me/achievements**
è·å–å½“å‰ç”¨æˆ·çš„æˆå°±è¿›åº¦
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "achievements": [
      {
        "achievementId": "uuid",
        "name": "é²œèŠ±è¾¾äºº",
        "description": "ç´¯è®¡è·å¾—100æœµé²œèŠ±",
        "icon": "https://...",
        "category": "ç¤¾äº¤ç±»",
        "conditionType": "total_roses",
        "conditionValue": 100,
        "currentValue": 80,  // å½“å‰è¿›åº¦
        "progress": 80.0,    // ç™¾åˆ†æ¯”
        "isUnlocked": false,
        "rewardRoses": 50
      },
      {
        "achievementId": "uuid",
        "name": "åˆå‡ºèŒ…åº",
        "description": "è·å¾—ç¬¬ä¸€æœµé²œèŠ±",
        "isUnlocked": true,
        "unlockedAt": "2025-12-15T10:00:00Z"
      }
    ]
  }
}
```

---

### **7. ç­¾åˆ°æ¨¡å—**

#### **POST /api/users/me/signin**
æ¯æ—¥ç­¾åˆ°
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "consecutiveDays": 5,
    "rewardRoses": 20,  // åŸºç¡€10 + è¿ç»­å¥–åŠ±10
    "rewardPacks": [
      {
        "packId": "uuid",
        "name": "æ™®é€šå¡åŒ…",
        "count": 1
      }
    ],
    "totalRoses": 120,  // ç­¾åˆ°åçš„æ€»é²œèŠ±æ•°
    "unlockedAchievements": [  // å¯èƒ½è§£é”çš„æˆå°±
      {
        "achievementId": "uuid",
        "name": "åšæŒä¸æ‡ˆ",
        "rewardRoses": 50
      }
    ]
  }
}

é”™è¯¯å“åº”ï¼ˆå·²ç­¾åˆ°ï¼‰ï¼š
{
  "success": false,
  "error": "ä»Šå¤©å·²ç»ç­¾åˆ°è¿‡äº†"
}
```

#### **GET /api/users/me/signin/status**
è·å–ç­¾åˆ°çŠ¶æ€
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "hasSignedToday": true,
    "consecutiveDays": 5,
    "lastSignInAt": "2025-12-23T08:00:00Z",
    "nextReward": {
      "roses": 22,
      "packs": []
    }
  }
}
```

#### **GET /api/users/me/signin/history**
è·å–ç­¾åˆ°å†å²
```json
è¯·æ±‚å‚æ•°ï¼š
?page=1
&limit=30

å“åº”ï¼š
{
  "success": true,
  "data": {
    "records": [
      {
        "day": 5,
        "rewardRoses": 20,
        "claimedAt": "2025-12-23T08:00:00Z"
      },
      {
        "day": 4,
        "rewardRoses": 18,
        "claimedAt": "2025-12-22T09:00:00Z"
      }
    ],
    "total": 30
  }
}
```

---

### **8. æ’è¡Œæ¦œæ¨¡å—**

#### **GET /api/leaderboard/roses**
é²œèŠ±æ’è¡Œæ¦œ
```json
è¯·æ±‚å‚æ•°ï¼š
?limit=100

å“åº”ï¼š
{
  "success": true,
  "data": {
    "leaderboard": [
      {
        "rank": 1,
        "userId": "uuid",
        "username": "user1",
        "totalRoses": 1000,
        "level": 10
      },
      {
        "rank": 2,
        "userId": "uuid",
        "username": "user2",
        "totalRoses": 800,
        "level": 8
      }
    ],
    "myRank": {
      "rank": 50,
      "totalRoses": 100
    }
  }
}
```

#### **GET /api/leaderboard/vocab**
å•è¯æ”¶è—æ’è¡Œæ¦œ
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "leaderboard": [
      {
        "rank": 1,
        "userId": "uuid",
        "username": "user1",
        "vocabCount": 500,
        "level": 10
      }
    ],
    "myRank": {
      "rank": 30,
      "vocabCount": 80
    }
  }
}
```

#### **GET /api/leaderboard/packs**
å¼€åŒ…æ’è¡Œæ¦œ
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "leaderboard": [
      {
        "rank": 1,
        "userId": "uuid",
        "username": "user1",
        "totalPacks": 200,
        "level": 10
      }
    ],
    "myRank": {
      "rank": 40,
      "totalPacks": 50
    }
  }
}
```

#### **GET /api/leaderboard/consecutive**
è¿ç»­ç­¾åˆ°æ’è¡Œæ¦œ
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "leaderboard": [
      {
        "rank": 1,
        "userId": "uuid",
        "username": "user1",
        "consecutiveDays": 30
      }
    ],
    "myRank": {
      "rank": 20,
      "consecutiveDays": 5
    }
  }
}
```

---

### **9. æ¶ˆæ¯æ¨¡å—ï¼ˆHTTPéƒ¨åˆ†ï¼‰**

#### **GET /api/messages**
è·å–å†å²æ¶ˆæ¯ï¼ˆæœ€è¿‘24å°æ—¶ï¼‰
```json
è¯·æ±‚å‚æ•°ï¼š
?before=timestamp     // è·å–è¿™ä¸ªæ—¶é—´ä¹‹å‰çš„æ¶ˆæ¯
&limit=50             // æ¯æ¬¡è·å–æ•°é‡

å“åº”ï¼š
{
  "success": true,
  "data": {
    "messages": [
      {
        "messageId": "uuid",
        "userId": "uuid",
        "username": "user1",
        "content": "Hello world",
        "roses": 5,
        "timestamp": 1703318400000,
        "replyTo": null,  // å¼•ç”¨çš„æ¶ˆæ¯ID
        "hasRosed": false  // å½“å‰ç”¨æˆ·æ˜¯å¦å·²é€èŠ±
      }
    ],
    "hasMore": true
  }
}
```

#### **GET /api/messages/:messageId**
è·å–å•æ¡æ¶ˆæ¯è¯¦æƒ…
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "messageId": "uuid",
    "userId": "uuid",
    "username": "user1",
    "content": "Hello world",
    "roses": 5,
    "timestamp": 1703318400000,
    "replyTo": {
      "messageId": "uuid",
      "content": "Hi",
      "username": "user2"
    },
    "roseSenders": [  // é€èŠ±çš„äºº
      {
        "userId": "uuid",
        "username": "user3",
        "sentAt": "2025-12-23T10:00:00Z"
      }
    ]
  }
}
```

---

### **10. ç®¡ç†å‘˜æ¨¡å—**

**æƒé™è¯´æ˜ï¼š**
- **SUPER_ADMIN**ï¼šå¯æ‰§è¡Œæ‰€æœ‰ç®¡ç†æ“ä½œï¼ŒåŒ…æ‹¬è®¾ç½®ç”¨æˆ·è§’è‰²
- **ADMIN**ï¼šå¯å°ç¦ç”¨æˆ·ã€åˆ é™¤æ¶ˆæ¯ã€æ·»åŠ å•è¯ï¼Œä½†ä¸èƒ½ä¿®æ”¹ç”¨æˆ·è§’è‰²
- **USER**ï¼šæ— ç®¡ç†æƒé™

#### **PUT /api/admin/users/:userId/role**
ä¿®æ”¹ç”¨æˆ·è§’è‰²ï¼ˆä»… SUPER_ADMINï¼‰
```json
è¯·æ±‚ï¼š
{
  "role": "ADMIN"  // SUPER_ADMIN/ADMIN/USER
}

å“åº”ï¼š
{
  "success": true,
  "data": {
    "userId": "uuid",
    "username": "testuser",
    "role": "ADMIN"
  }
}

é”™è¯¯å“åº”ï¼ˆæƒé™ä¸è¶³ï¼‰ï¼š
{
  "success": false,
  "error": "åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯ä»¥ä¿®æ”¹ç”¨æˆ·è§’è‰²"
}
```

#### **GET /api/admin/users**
è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
```json
è¯·æ±‚å‚æ•°ï¼š
?role=ADMIN           // æŒ‰è§’è‰²ç­›é€‰
&isBanned=false       // æŒ‰å°ç¦çŠ¶æ€ç­›é€‰
&search=username      // æœç´¢ç”¨æˆ·å
&page=1
&limit=20

å“åº”ï¼š
{
  "success": true,
  "data": {
    "users": [
      {
        "userId": "uuid",
        "username": "user1",
        "role": "ADMIN",
        "totalRoses": 100,
        "isBanned": false,
        "registeredAt": "2025-12-01T10:00:00Z",
        "lastLoginAt": "2025-12-23T10:00:00Z"
      }
    ],
    "total": 50,
    "page": 1,
    "limit": 20
  }
}
```

#### **POST /api/admin/users/:userId/ban**
å°ç¦ç”¨æˆ·ï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
```json
è¯·æ±‚ï¼š
{
  "reason": "è¿è§„å‘è¨€",
  "duration": 86400  // å°ç¦æ—¶é•¿ï¼ˆç§’ï¼‰ï¼Œ0è¡¨ç¤ºæ°¸ä¹…
}

å“åº”ï¼š
{
  "success": true,
  "data": {
    "userId": "uuid",
    "isBanned": true,
    "bannedUntil": "2025-12-24T10:00:00Z"
  }
}
```

#### **POST /api/admin/users/:userId/unban**
è§£å°ç”¨æˆ·
```json
å“åº”ï¼š
{
  "success": true,
  "data": {
    "userId": "uuid",
    "isBanned": false
  }
}
```

#### **DELETE /api/admin/messages/:messageId**
åˆ é™¤æ¶ˆæ¯
```json
å“åº”ï¼š
{
  "success": true
}
```

#### **POST /api/admin/words**
æ·»åŠ æ–°å•è¯
```json
è¯·æ±‚ï¼š
{
  "word": "serendipity",
  "definition": "æ„å¤–å‘ç°çå¥‡äº‹ç‰©çš„æœ¬é¢†",
  "rarity": "legendary",
  "pronunciation": "/ËŒserÉ™nËˆdÉªpÉ™ti/",
  "partOfSpeech": "noun",
  "variants": ["serendipities"]
}

å“åº”ï¼š
{
  "success": true,
  "data": {
    "wordId": "uuid",
    "word": "serendipity",
    ...
  }
}
```

---

## ğŸ”Œ WebSocket æ¥å£

### **è¿æ¥åœ°å€ï¼š**
```
ws://localhost:3000/ws
æˆ–
wss://yourdomain.com/ws
```

### **è¿æ¥æ—¶éœ€è¦æºå¸¦ Tokenï¼š**
```javascript
const ws = new WebSocket('ws://localhost:3000/ws?token=jwt_token');
```

---

### **1. å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨ï¼ˆå‘é€æ¶ˆæ¯ï¼‰**

#### **äº‹ä»¶ï¼šsendMessage**
å‘é€èŠå¤©æ¶ˆæ¯
```json
{
  "type": "sendMessage",
  "data": {
    "content": "Hello world",
    "replyTo": "message_uuid"  // å¯é€‰ï¼Œå¼•ç”¨çš„æ¶ˆæ¯ID
  }
}
```

#### **äº‹ä»¶ï¼štoggleRose**
é€èŠ±/å–æ¶ˆé€èŠ±
```json
{
  "type": "toggleRose",
  "data": {
    "messageId": "uuid"
  }
}
```

#### **äº‹ä»¶ï¼štyping**
ç”¨æˆ·æ­£åœ¨è¾“å…¥
```json
{
  "type": "typing",
  "data": {
    "isTyping": true
  }
}
```

#### **äº‹ä»¶ï¼šheartbeat**
å¿ƒè·³åŒ…ï¼ˆä¿æŒè¿æ¥ï¼‰
```json
{
  "type": "heartbeat",
  "data": {
    "timestamp": 1703318400000
  }
}
```

---

### **2. æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯ï¼ˆæ¥æ”¶æ¶ˆæ¯ï¼‰**

#### **äº‹ä»¶ï¼šmessage**
æ–°æ¶ˆæ¯å¹¿æ’­
```json
{
  "type": "message",
  "data": {
    "messageId": "uuid",
    "userId": "uuid",
    "username": "user1",
    "content": "Hello world",
    "roses": 0,
    "timestamp": 1703318400000,
    "replyTo": null
  }
}
```

#### **äº‹ä»¶ï¼šroseUpdate**
é€èŠ±æ›´æ–°
```json
{
  "type": "roseUpdate",
  "data": {
    "messageId": "uuid",
    "roses": 5,
    "action": "added",  // "added" æˆ– "removed"
    "senderId": "uuid",
    "senderUsername": "user2"
  }
}
```

#### **äº‹ä»¶ï¼šuserJoined**
ç”¨æˆ·ä¸Šçº¿
```json
{
  "type": "userJoined",
  "data": {
    "userId": "uuid",
    "username": "user1",
    "timestamp": 1703318400000
  }
}
```

#### **äº‹ä»¶ï¼šuserLeft**
ç”¨æˆ·ä¸‹çº¿
```json
{
  "type": "userLeft",
  "data": {
    "userId": "uuid",
    "username": "user1",
    "timestamp": 1703318400000
  }
}
```

#### **äº‹ä»¶ï¼šonlineUsers**
åœ¨çº¿ç”¨æˆ·åˆ—è¡¨æ›´æ–°
```json
{
  "type": "onlineUsers",
  "data": {
    "count": 15,
    "users": [
      {
        "userId": "uuid",
        "username": "user1"
      },
      {
        "userId": "uuid",
        "username": "user2"
      }
    ]
  }
}
```

#### **äº‹ä»¶ï¼šuserTyping**
æœ‰ç”¨æˆ·æ­£åœ¨è¾“å…¥
```json
{
  "type": "userTyping",
  "data": {
    "userId": "uuid",
    "username": "user1",
    "isTyping": true
  }
}
```

#### **äº‹ä»¶ï¼šnotification**
ç³»ç»Ÿé€šçŸ¥
```json
{
  "type": "notification",
  "data": {
    "notificationType": "achievement",  // "achievement", "collection", "system"
    "title": "è§£é”æ–°æˆå°±",
    "message": "æ­å–œä½ è§£é”æˆå°±ï¼šé²œèŠ±è¾¾äºº",
    "data": {
      "achievementId": "uuid",
      "name": "é²œèŠ±è¾¾äºº",
      "rewardRoses": 50
    }
  }
}
```

#### **äº‹ä»¶ï¼šerror**
é”™è¯¯æ¶ˆæ¯
```json
{
  "type": "error",
  "data": {
    "code": "BANNED",
    "message": "ä½ å·²è¢«å°ç¦"
  }
}
```

#### **äº‹ä»¶ï¼šheartbeatAck**
å¿ƒè·³å“åº”
```json
{
  "type": "heartbeatAck",
  "data": {
    "timestamp": 1703318400000
  }
}
```

---

## ğŸ“Š æ¥å£æ€»ç»“

### **HTTP æ¥å£ï¼ˆå…±çº¦ 37 ä¸ªï¼‰ï¼š**

**è®¤è¯ï¼ˆ4ä¸ªï¼‰ï¼š**
- POST /api/auth/register
- POST /api/auth/login
- POST /api/auth/logout
- GET /api/auth/verify

**ç”¨æˆ·ï¼ˆ3ä¸ªï¼‰ï¼š**
- GET /api/users/me
- GET /api/users/:userId
- PUT /api/users/me

**å•è¯ï¼ˆ4ä¸ªï¼‰ï¼š**
- GET /api/words
- GET /api/words/:wordId
- GET /api/users/me/words
- POST /api/users/me/words/:wordId/favorite

**å¡åŒ…ï¼ˆ3ä¸ªï¼‰ï¼š**
- GET /api/packs
- GET /api/users/me/packs
- POST /api/users/me/packs/:packId/open

**å›¾é‰´ï¼ˆ3ä¸ªï¼‰ï¼š**
- GET /api/collections
- GET /api/collections/:collectionId
- GET /api/users/me/collections

**æˆå°±ï¼ˆ2ä¸ªï¼‰ï¼š**
- GET /api/achievements
- GET /api/users/me/achievements

**ç­¾åˆ°ï¼ˆ3ä¸ªï¼‰ï¼š**
- POST /api/users/me/signin
- GET /api/users/me/signin/status
- GET /api/users/me/signin/history

**æ’è¡Œæ¦œï¼ˆ4ä¸ªï¼‰ï¼š**
- GET /api/leaderboard/roses
- GET /api/leaderboard/vocab
- GET /api/leaderboard/packs
- GET /api/leaderboard/consecutive

**æ¶ˆæ¯ï¼ˆ2ä¸ªï¼‰ï¼š**
- GET /api/messages
- GET /api/messages/:messageId

**ç®¡ç†å‘˜ï¼ˆ6ä¸ªï¼‰ï¼š**
- PUT /api/admin/users/:userId/roleï¼ˆä»…è¶…çº§ç®¡ç†å‘˜ï¼‰
- GET /api/admin/usersï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
- POST /api/admin/users/:userId/banï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
- POST /api/admin/users/:userId/unbanï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
- DELETE /api/admin/messages/:messageIdï¼ˆç®¡ç†å‘˜æƒé™ï¼‰
- POST /api/admin/wordsï¼ˆç®¡ç†å‘˜æƒé™ï¼‰

---

### **WebSocket äº‹ä»¶ï¼ˆå…± 12 ä¸ªï¼‰ï¼š**

**å®¢æˆ·ç«¯å‘é€ï¼ˆ4ä¸ªï¼‰ï¼š**
- sendMessageï¼ˆå‘é€æ¶ˆæ¯ï¼‰
- toggleRoseï¼ˆé€èŠ±/å–æ¶ˆï¼‰
- typingï¼ˆæ­£åœ¨è¾“å…¥ï¼‰
- heartbeatï¼ˆå¿ƒè·³ï¼‰

**æœåŠ¡å™¨æ¨é€ï¼ˆ8ä¸ªï¼‰ï¼š**
- messageï¼ˆæ–°æ¶ˆæ¯ï¼‰
- roseUpdateï¼ˆé€èŠ±æ›´æ–°ï¼‰
- userJoinedï¼ˆç”¨æˆ·ä¸Šçº¿ï¼‰
- userLeftï¼ˆç”¨æˆ·ä¸‹çº¿ï¼‰
- onlineUsersï¼ˆåœ¨çº¿ç”¨æˆ·ï¼‰
- userTypingï¼ˆæœ‰äººè¾“å…¥ï¼‰
- notificationï¼ˆç³»ç»Ÿé€šçŸ¥ï¼‰
- errorï¼ˆé”™è¯¯æ¶ˆæ¯ï¼‰
- heartbeatAckï¼ˆå¿ƒè·³å“åº”ï¼‰

---

## ğŸ¯ æ¥å£ä¼˜å…ˆçº§å»ºè®®

### **ç¬¬ä¸€é˜¶æ®µï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰ï¼š**
1. âœ… ç”¨æˆ·è®¤è¯ï¼ˆæ³¨å†Œã€ç™»å½•ï¼‰
2. âœ… WebSocket èŠå¤©ï¼ˆå‘é€æ¶ˆæ¯ã€æ¥æ”¶æ¶ˆæ¯ï¼‰
3. âœ… é€èŠ±åŠŸèƒ½ï¼ˆtoggleRoseï¼‰
4. âœ… è·å–å†å²æ¶ˆæ¯
5. âœ… åœ¨çº¿ç”¨æˆ·åˆ—è¡¨

### **ç¬¬äºŒé˜¶æ®µï¼ˆå•è¯ç³»ç»Ÿï¼‰ï¼š**
6. âœ… è·å–å•è¯åˆ—è¡¨
7. âœ… è·å–ç”¨æˆ·å•è¯åº“å­˜
8. âœ… å¼€å¡åŒ…
9. âœ… æ”¶è—å•è¯

### **ç¬¬ä¸‰é˜¶æ®µï¼ˆæˆå°±ç³»ç»Ÿï¼‰ï¼š**
10. âœ… å›¾é‰´è¿›åº¦
11. âœ… æˆå°±åˆ—è¡¨
12. âœ… æ¯æ—¥ç­¾åˆ°

### **ç¬¬å››é˜¶æ®µï¼ˆç¤¾äº¤åŠŸèƒ½ï¼‰ï¼š**
13. âœ… æ’è¡Œæ¦œ
14. âœ… ç”¨æˆ·èµ„æ–™
15. âœ… é‚€è¯·ç³»ç»Ÿ

### **ç¬¬äº”é˜¶æ®µï¼ˆç®¡ç†åŠŸèƒ½ï¼‰ï¼š**
16. âœ… ç®¡ç†å‘˜æ¥å£
17. âœ… æ•°æ®ç»Ÿè®¡

---

## ğŸ” å®‰å…¨å»ºè®®

### **1. è®¤è¯æ–¹å¼ï¼š**
- ä½¿ç”¨ JWT Token
- Token æœ‰æ•ˆæœŸï¼š7å¤©
- æ”¯æŒ Token åˆ·æ–°

### **2. æƒé™æ§åˆ¶ï¼š**
- **USERï¼ˆæ™®é€šç”¨æˆ·ï¼‰**ï¼šåªèƒ½æ“ä½œè‡ªå·±çš„æ•°æ®
- **ADMINï¼ˆæ™®é€šç®¡ç†å‘˜ï¼‰**ï¼šå¯ç®¡ç†ç”¨æˆ·ã€å•è¯ã€æ¶ˆæ¯ç­‰å†…å®¹
- **SUPER_ADMINï¼ˆè¶…çº§ç®¡ç†å‘˜ï¼‰**ï¼šæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼ŒåŒ…æ‹¬è®¾ç½®ç®¡ç†å‘˜
- WebSocket è¿æ¥éœ€è¦éªŒè¯ Token
- æ‰€æœ‰ç®¡ç†æ¥å£éœ€è¦éªŒè¯ç”¨æˆ·è§’è‰²

### **3. é€Ÿç‡é™åˆ¶ï¼š**
- å‘é€æ¶ˆæ¯ï¼šæ¯åˆ†é’Ÿæœ€å¤š 20 æ¡
- é€èŠ±ï¼šæ¯åˆ†é’Ÿæœ€å¤š 30 æ¬¡
- å¼€å¡åŒ…ï¼šæ¯åˆ†é’Ÿæœ€å¤š 10 æ¬¡
- API è¯·æ±‚ï¼šæ¯åˆ†é’Ÿæœ€å¤š 100 æ¬¡

### **4. æ•°æ®éªŒè¯ï¼š**
- æ¶ˆæ¯é•¿åº¦é™åˆ¶ï¼š500 å­—ç¬¦
- ç”¨æˆ·åé•¿åº¦ï¼š3-20 å­—ç¬¦
- å¯†ç å¼ºåº¦ï¼šè‡³å°‘ 8 ä½

---
