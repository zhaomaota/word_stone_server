# 用户认证系统说明

## 配置说明

### JWT_SECRET（.env 文件）

**这是什么？**
- JWT_SECRET 是用于加密和验证用户登录凭证（JWT Token）的密钥
- 它就像一把"钥匙"，用来签名和验证用户的身份信息

**如何设置？**
1. 打开 `.env` 文件
2. 修改 `JWT_SECRET` 为任何复杂的随机字符串
3. **重要：** 生产环境必须使用强密码，并且保密！

**示例：**
```
JWT_SECRET="my-super-secret-key-change-me-in-production-abc123xyz789"
```

你可以使用以下方式生成随机密钥：
```bash
# 方法1：Node.js
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"

# 方法2：随机字符串
任意复杂的字符串，如：aB3$9zX#kL2@mN7pQ!8wR
```

## 服务器配置

### 端口配置
- **HTTP API + WebSocket**: 端口 3000
- 所有API接口: `http://localhost:3000/api`
- WebSocket连接: `http://localhost:3000`

### 前端配置
在 `src/config.js` 中统一管理：
```javascript
export const config = {
  SERVER_URL: 'http://localhost:3000',      // WebSocket服务器
  API_BASE_URL: 'http://localhost:3000/api' // HTTP API地址
};
```

## 使用说明

### 1. 注册新账号
- 打开游戏，点击"没有账号？去注册"
- 输入用户名（3-20字符）
- 输入密码（至少8位）
- 可选：输入邀请码
- 点击"注册"

### 2. 登录
- 输入用户名和密码
- 点击"登录"
- 登录成功后自动连接到游戏服务器

### 3. 在线功能
登录后可以：
- ✅ 查看在线用户列表
- ✅ 发送消息聊天
- ✅ 给其他玩家送花
- ✅ 查看自己的资料

### 4. 退出登录
点击右上角的"退出"按钮即可退出登录

## 用户角色

系统支持三种角色：

1. **USER（普通用户）** - 默认角色
   - 玩游戏、聊天、送花

2. **ADMIN（普通管理员）**
   - 可以封禁用户
   - 可以删除消息
   - 可以管理游戏内容

3. **SUPER_ADMIN（超级管理员）**
   - 拥有所有权限
   - 可以设置其他管理员

## API 接口

### 认证接口
- `POST /api/auth/register` - 注册
- `POST /api/auth/login` - 登录
- `GET /api/auth/verify` - 验证Token

### 用户接口
- `GET /api/users/me` - 获取当前用户信息
- `GET /api/users/:userId` - 获取用户信息

### 管理员接口（需要权限）
- `PUT /api/admin/users/:userId/role` - 修改用户角色
- `POST /api/admin/users/:userId/ban` - 封禁用户
- `POST /api/admin/users/:userId/unban` - 解封用户
- `GET /api/admin/users` - 获取用户列表

## 常见问题

### Q: 为什么登录后看不到在线用户？
A: 确保：
1. 后端服务器运行在 3000 端口
2. 前端的 WebSocket 连接地址是 `http://localhost:3000`
3. 刷新页面重新登录

### Q: 为什么无法发言？
A: 检查：
1. 是否已成功登录
2. WebSocket 连接状态（右上角应显示在线用户数）
3. 浏览器控制台是否有错误

### Q: JWT_SECRET 可以修改吗？
A: 可以，但注意：
- 修改后所有现有的 Token 都会失效
- 用户需要重新登录
- 建议在部署前设置好，之后尽量不改

### Q: 如何创建第一个管理员？
A: 需要直接在数据库中修改：
```sql
UPDATE users SET role = 'SUPER_ADMIN' WHERE username = '你的用户名';
```

## 数据库

PostgreSQL 数据库信息：
- 数据库名: vocab_game
- 主机: localhost
- 端口: 5432
- 用户名: postgres

使用 Prisma 进行数据库管理：
```bash
# 查看数据库结构
pnpm prisma studio

# 创建迁移
pnpm prisma migrate dev

# 生成客户端
pnpm prisma generate
```
